{% extends "base.html" %}

{% block content %}
<h2>Record Product Movement</h2>

<h3>New Movement (In/Out/Transfer)</h3>
<form method="POST">
    <label for="product_id">Product:</label>
    <select id="product_id" name="product_id" required>
        <option value="">-- Select Product --</option>
        {% for product in products %}
        <option value="{{ product.product_id }}">{{ product.name }}</option>
        {% endfor %}
    </select><br><br>
    
    <label for="qty">Quantity:</label>
    <input type="number" id="qty" name="qty" required min="1"><br><br>

    <label for="from_location">From Location (Outgoing/Transfer. Select 'None' for Incoming):</label>
    <select id="from_location" name="from_location">
        <option value="None">None (Incoming Movement)</option>
        {% for location in locations %}
        <option value="{{ location.location_id }}">{{ location.name }}</option>
        {% endfor %}
    </select><br><br>
    
    <label for="to_location">To Location (Incoming/Transfer. Select 'None' for Outgoing/Sale):</label>
    <select id="to_location" name="to_location">
        <option value="None">None (Outgoing Movement/Sale)</option>
        {% for location in locations %}
        <option value="{{ location.location_id }}">{{ location.name }}</option>
        {% endfor %}
    </select><br><br>
    
    <button type="submit">Record Movement</button>
</form>

<hr>

<h3>Recent Movements</h3>
<table>
    <thead>
        <tr>
            <th>Timestamp</th>
            <th>Product</th>
            <th>From</th>
            <th>To</th>
            <th>Qty</th>
        </tr>
    </thead>
    <tbody>
        {% for movement in movements %}
        <tr>
            <td>{{ movement.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ movement.product.name }}</td>
            <td>{{ movement.location_from.name if movement.location_from else 'Incoming' }}</td>
            <td>{{ movement.location_to.name if movement.location_to else 'Outgoing' }}</td>
            <td>{{ movement.qty }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}